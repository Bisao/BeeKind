<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>P2P Circle Game</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #222; font-family: sans-serif; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; }
        canvas { background: #000; border: 2px solid #444; display: none; }
        #menu { text-align: center; background: #333; padding: 20px; border-radius: 10px; }
        input { padding: 10px; border-radius: 5px; border: none; margin: 10px; }
        button { padding: 10px 20px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>

    <div id="menu">
        <h1>Círculos P2P</h1>
        <div id="setup">
            <p>Seu ID: <strong id="my-id">...</strong></p>
            <button onclick="createRoom()">Criar Sala</button>
            <hr>
            <input type="text" id="join-id" placeholder="ID do Amigo">
            <button onclick="joinRoom()" style="background: #007bff;">Entrar na Sala</button>
        </div>
        <p id="status"></p>
    </div>

    <canvas id="gameCanvas" width="600" height="400"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const menu = document.getElementById('menu');
        const status = document.getElementById('status');
        
        let peer = new Peer(); // Cria um ID aleatório para você
        let conn;
        let players = {
            me: { x: 100, y: 100, color: 'lime' },
            peer: { x: 500, y: 100, color: 'red' }
        };

        // Exibe seu ID na tela
        peer.on('open', id => document.getElementById('my-id').innerText = id);

        // --- Lógica de Conexão ---

        // Quando alguém se conecta a você (Host)
        peer.on('connection', c => {
            conn = c;
            setupConnection();
            startGame();
        });

        function joinRoom() {
            const id = document.getElementById('join-id').value;
            if (!id) return alert("Digite um ID!");
            conn = peer.connect(id);
            setupConnection();
            startGame();
        }

        function createRoom() {
            status.innerText = "Aguardando amigo se conectar...";
        }

        function setupConnection() {
            conn.on('data', data => {
                // Atualiza a posição do outro jogador
                players.peer.x = data.x;
                players.peer.y = data.y;
            });
            conn.on('open', () => status.innerText = "Conectado!");
        }

        // --- Lógica do Jogo ---

        function startGame() {
            menu.style.display = 'none';
            canvas.style.display = 'block';
            gameLoop();
        }

        // Movimentação
        window.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            players.me.x = e.clientX - rect.left;
            players.me.y = e.clientY - rect.top;

            // Envia sua posição para o outro jogador
            if (conn && conn.open) {
                conn.send({ x: players.me.x, y: players.me.y });
            }
        });

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Desenha você
            drawCircle(players.me.x, players.me.y, players.me.color);
            // Desenha o outro
            drawCircle(players.peer.x, players.peer.y, players.peer.color);

            requestAnimationFrame(gameLoop);
        }

        function drawCircle(x, y, color) {
            ctx.beginPath();
            ctx.arc(x, y, 20, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.closePath();
        }
    </script>
</body>
</html>
